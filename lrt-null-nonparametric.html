<!DOCTYPE html>
<!-- from http://bl.ocks.org/mbostock/4339083
and http://bl.ocks.org/mbostock/4063550

!-->
<meta charset="utf-8">
<style>

.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 1.5px;
}

.node {
  font: 10px sans-serif;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1.5px;
}
#tree1par {
  vertical-align: top;
  float: left;
}
#tree2par {
  vertical-align: center;
  float: left;
}
#tree3par {
  vertical-align: bottom;
  float: left;
}
#histpar {
  vertical-align: top;
  float: right;
}
</style>
<body>
<script src="d3/d3.v3.min.js"></script>
<script src="jquery/jquery.v2.min.js"></script>
<div>
<h2><b>Figure 1</b> the relationship between the per-site LRT and the <it>P</it>-value in a hypothetical case.</h2>
<p>Consider the case of a dataset which has 1000 characters 
(or sites in a sequence alignment) and the alternative tree has a
log-likelihood that is 5.0 higher than the null hypothesized tree.
If we do not use asymptotic assumptions to connect the 2*(the difference in log-likelihoods) to 
the chi-square distribution, then try to infer a null distribution based on the per-site
differences in log-likelihoods.</p>
<p>
If we construct the null distribution in this way, we find that the variability of the support
across characters if very important to assessing the statistical significance of a log-likelihood difference.
</p>
<p>
Typically we want to test a null hypothesis that the two trees are equally good explanations of the data.
Thus under the null, the expected mean difference log-likelihoods per-site should be 0.
So, if we have a method of producing a plausible amount of variability in the per-site log-likelihood
differences, we can generate a null distribution at the per-site level.
</p><p id="sampletext">
Because the total difference in log-likelhoods is simply the sum of the differences for all sites, we can
get the null distribution of the total log-likelihood difference from the per-site null distribution.
</p>
</div>
<table>
  <tr>
    <td>
      <label for="abCount" id="var">
          <font id="idFont">Variability of log-likelihood differences across sites:</font>
      </label>
      <select name="varselect" id="varselect">
          <option id="novar" value="novar" selected="selected">All site differences = 0.05</option>
          <option id="onesite" value="onesite">One site differs by 5.00</option>
          <option id="conflict" value="conflict">One site diff = 0; 500 sites = +5; 499 sites = -5.0</option>
      </select>
    </td>
  </tr>
  <tr><td>Distribution of per-site differences:</td></tr>
  <tr><td><span id="per-site-diff-dist"></span></td></tr>
  <tr>
    <td>
      <label for="centerLabel" id="centerLabel"> <font id="idFont">Method of centering to per-site difference to have expectation of 0:</font></label>
      <select name="centerselect" id="centerselect">
          <option id="subtract" value="subtract" selected="selected">subtract mean</option>
          <option id="reflect" value="reflect">append "mirror image" dataset</option>
      </select>
    </td>
  </tr>
  <tr><td><span id="null-per-site-diff-dist"></span></td></tr>
  <tr><td>
          <input name="boot" type="button" value="generate null distributions" onclick="genNull()" />
  </td></tr>
      <br/>
        </td><td><div id="hist"/></td></tr>
</table>
<br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <p> Thanks to <a href="http://bl.ocks.org/mbostock/3048450">http://bl.ocks.org/mbostock/3048450</a></p>.
<script>
var PER_SITE_WIDTH = 400;
var PER_SITE_HEIGHT = 180;
var margin = {top: 10, right: 10, bottom: 20, left: 15}
var width = PER_SITE_WIDTH - margin.left - margin.right;
var height = PER_SITE_HEIGHT - margin.top - margin.bottom;

var total_diff = 5.0;
var num_char = 50;

var orig_mean_ps = total_diff / num_char;
var half_num_char = num_char/2;
$("#novar").text("All sites' differences = " + orig_mean_ps.toPrecision(3));
$("#onesite").text("" + (num_char - 1) + " sites with diff.=0 and one with diff.=" + total_diff.toPrecision(1));
$("#conflict").text("One site w/ diff.=0; " 
                    + half_num_char +  " with diff.=" + (total_diff/num_char).toPrecision(1)
                    + "; and " + (half_num_char - 1) + " with diff.=" + (-total_diff/num_char).toPrecision(1));
var ps_groups_zero_to_five = 250;
var ps_num_bins = 2*ps_groups_zero_to_five + 1;
var no_var_values = [];
var one_site_values = [];
var conflict_values = [];
var i = 0;
var tol = orig_mean_ps;
var zero_offset = total_diff + tol
for (i = 0; i < num_char; ++i) {
    no_var_values[i] = zero_offset + orig_mean_ps;
}
for (i = 0; i < num_char - 1; ++i) {
    one_site_values[i] = zero_offset;
}
one_site_values[num_char - 1] = zero_offset + total_diff;
for (i = 0; i < half_num_char; ++i) {
    conflict_values[i] = zero_offset + total_diff;
}
for (i = half_num_char; i < num_char - 1; ++i) {
    conflict_values[i] = zero_offset - total_diff;
}
conflict_values[num_char - 1] = zero_offset + 0.0;
var ps_x = d3.scale.linear().domain([0, 2*total_diff + tol]).range([0, width]);
var thresholds = [];
var bin_w = (2*total_diff)/ps_num_bins;
var min_x = 0;
var curr_thres = min_x;
for (i = 0; i < ps_num_bins + 1 ; ++i) {
    thresholds[i] = curr_thres;
    curr_thres += bin_w;
}
var os_histdata = d3.layout.histogram().bins(thresholds)(one_site_values);
var nv_histdata = d3.layout.histogram().bins(thresholds)(no_var_values);
var conf_histdata = d3.layout.histogram().bins(thresholds)(conflict_values);
var ps_y = d3.scale.linear().domain([0, num_char]).range([height, 0]);
var ps_x_axis = d3.svg.axis().scale(ps_x).orient("bottom");
/* data for two ways of getting a null per-site for the no-variation data*/
var subtract_nv_values = [];
var reflect_nv_values = [];
for (i = 0; i < num_char; ++i) {
    subtract_nv_values[i] = zero_offset;
}
for (i = 0; i < num_char; ++i) {
    reflect_nv_values[i] = zero_offset + orig_mean_ps;
}
for (i = num_char; i < 2*num_char; ++i) {
    reflect_nv_values[i] = zero_offset - orig_mean_ps;
}

/* data for two ways of getting a null per-site for the one-site data */
var subtract_os_values = [];
var reflect_os_values = [];
for (i = 0; i < num_char - 1; ++i) {
    subtract_os_values[i] = zero_offset - orig_mean_ps;
}
subtract_os_values[num_char - 1] = zero_offset + total_diff - orig_mean_ps;
for (i = 0; i < 2*num_char - 2; ++i) {
    reflect_os_values[i] = zero_offset;
}
reflect_os_values[2*num_char - 2] = zero_offset + total_diff;
reflect_os_values[2*num_char - 1] = zero_offset - total_diff;

/* data for two ways of getting a null per-site for the conflict data */
var subtract_co_values = [];
var reflect_co_values = [];
for (i = 0; i < half_num_char - 1; ++i) {
    subtract_co_values[i] = zero_offset - total_diff - orig_mean_ps;
}
subtract_co_values[half_num_char - 1] = zero_offset - orig_mean_ps;
for (i = half_num_char; i < num_char; ++i) {
    subtract_co_values[i] = zero_offset + total_diff - orig_mean_ps;
}
for (i = 0; i < num_char - 1; ++i) {
    reflect_co_values[i] = zero_offset - total_diff;
}
reflect_co_values[num_char - 1] = zero_offset;
reflect_co_values[num_char] = zero_offset;
for (i = num_char + 1; i < 2*num_char; ++i) {
    reflect_co_values[i] = zero_offset + total_diff;
}
/* reflect form of enforcing a mean of 0, creates twice as many chars */
var ref_ps_y = d3.scale.linear().domain([0, 2*num_char]).range([height, 0]);
var subtract_nv_histdata = d3.layout.histogram().bins(thresholds)(subtract_nv_values);
var reflect_nv_histdata = d3.layout.histogram().bins(thresholds)(reflect_nv_values);
var subtract_os_histdata = d3.layout.histogram().bins(thresholds)(subtract_os_values);
var reflect_os_histdata = d3.layout.histogram().bins(thresholds)(reflect_os_values);
var subtract_co_histdata = d3.layout.histogram().bins(thresholds)(subtract_co_values);
var reflect_co_histdata = d3.layout.histogram().bins(thresholds)(reflect_co_values);

var fill_per_site_hist = function(hist_data, y_axis) {
    var par_el = d3.select('#per-site-diff-dist');
    append_hist_svg(par_el, hist_data, y_axis);
}
var fill_per_site_null = function(null_data, y_axis) {
    var par_el = d3.select('#null-per-site-diff-dist');
    append_hist_svg(par_el, null_data, y_axis);
}
var append_hist_svg = function(par_el, hist_data, y_axis) {
    par_el.selectAll("*").remove();
    hist_svg = par_el.append('svg')
        .attr("width", PER_SITE_WIDTH)
        .attr("height", PER_SITE_HEIGHT)
      .append("g")
        .attr('transform', "translate(" + margin.left + "," + margin.top + ")");
    var bar = hist_svg.selectAll(".bar")
        .data(hist_data)
      .enter().append("g")
        .attr("class", "bar")
        .attr("transform", function(d) { return "translate(" + ps_x(d.x) + "," + y_axis(d.y) + ")"; });
    bar.append("rect")
        .attr("x", 1)
        .attr("width", ps_x(hist_data[0].dx))
        .attr("height", function(d) { return height - y_axis(d.y); });
    add_x_axis(hist_svg);
}
var add_x_axis = function(hist_svg) {
    hist_svg.append("text")
        .attr("x", width*(total_diff + tol)/(2*total_diff + tol))
        .attr("y", height)
        .attr("dy", "1.0em")
        .attr("text-anchor", "middle")
        .text("0.0");
    hist_svg.append("text")
        .attr("x", tol)
        .attr("y", height)
        .attr("dy", "1.0em")
        .attr("text-anchor", "middle")
        .text("-5.0");
    hist_svg.append("text")
        .attr("x", width)
        .attr("y", height)
        .attr("dy", "1.0em")
        .attr("text-anchor", "middle")
        .text("5.0");
}
fill_per_site_hist(nv_histdata, ps_y);
fill_per_site_null(subtract_nv_histdata, ps_y);
var dist_change = function () {
    var vchoice = $("#varselect option:selected").attr("value");
    var cchoice = $("#centerselect option:selected").attr("value");
    if (vchoice == "novar") {
        fill_per_site_hist(nv_histdata, ps_y);
        if (cchoice == "subtract") {
            fill_per_site_null(subtract_nv_histdata, ps_y);
        } else {
            fill_per_site_null(reflect_nv_histdata, ref_ps_y);
       }
    } else if (vchoice == "conflict") {
        fill_per_site_hist(conf_histdata, ps_y);
        if (cchoice == "subtract") {
            fill_per_site_null(subtract_co_histdata, ps_y);
        } else {
            fill_per_site_null(reflect_co_histdata, ref_ps_y);
       }
    } else {
        fill_per_site_hist(os_histdata, ps_y);
        if (cchoice == "subtract") {
            fill_per_site_null(subtract_os_histdata, ps_y);
        } else {
            fill_per_site_null(reflect_os_histdata, ref_ps_y);
       }
    }
};
$('#varselect').change(dist_change);
$('#centerselect').change(dist_change);
</script>
